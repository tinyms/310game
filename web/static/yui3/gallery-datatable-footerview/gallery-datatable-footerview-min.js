YUI.add("gallery-datatable-footerview",function(e,t){e.FooterView=e.Base.create("tableFooter",e.View,[],{TMPL_td:'<td class="yui3-datatable-even {tdClass}">{content}</td>',TMPL_th:'<th colspan="{colspan}" class="{thClass}">{content}</th>',TMPL_tr:"<tr>{th_content}{td_content}</tr>",TMPL_tfoot:'<tfoot class="{footClass}"><tr>{th_content}{td_content}</tr></tfoot>',TMPL_table_fixed:'<table cellspacing="0" aria-hidden="true" class="{className}"></table>',dateFormat:"%D",timeFormat:"%T",fnReplace:e.Lang.sub,node_cols:null,_subscr:null,_dt:null,initializer:function(t){t=t?t:{},this._dt=t.source?t.source:t.host,this._subscr=[],t.footerConfig&&t.footerConfig.fixed&&this._dt.get("scrollable")&&this._subscr.push(e.Do.after(this._buildFixedFooter,this._dt,"_syncScrollUI",this._dt)),this._subscr.push(this._dt.data.after(["*:change","*:add","*:create","*:remove","*:reset"],e.bind("refreshFooter",this)))},destructor:function(){e.Array.each(this._subscr,function(e){e.detach()}),this._dt._tfootNode.empty(),this._dt._yScrollFooter&&this._dt._yScrollFooter.empty()},render:function(){var t=this.get("container"),n=this._dt,r=n.get("columns"),i=n.get("data"),s=n.get("footerConfig"),o=s.columns,u="",a="",f=1,l,c,h,p,d,v,m,g;this.node_cols=[],this.dateFormat=s&&s.dateFormat?s.dateFormat:n.get("dateFormat")?n.get("dateFormat"):this.dateFormat,this.timeFormat=s&&s.timeFormat?s.timeFormat:n.get("timeFormat")?n.get("timeFormat"):this.timeFormat,l={ROW_COUNT:i.size(),COL_COUNT:r.length,DATE:e.DataType.Date.format(new Date,{format:this.dateFormat}),TIME:e.DataType.Date.format(new Date,{format:this.timeFormat})},e.Object.each(l,function(e,t,n){n[t.toLowerCase()]=e}),s.heading&&(f=s.heading.colspan||f,u=this.fnReplace(this.TMPL_th,{colspan:f,thClass:" "+(s.heading.className||""),content:this.fnReplace(s.heading.content,l)}),c={index:0,key:0,td:null,th:s.heading,className:s.heading.className||"",formatter:"",content:null},this.node_cols.push(c)),h=[];for(g=f;g<r.length;g++)p=r[g],h.push({index:g,key:p.key,td:null,th:null,className:p.className||"",formatter:p.formatter||"",content:null});return e.Array.each(o,function(t){var n=-1;e.Array.some(h,function(e,r){if(e.key===t.key)return n=r,!0}),n!==-1&&(h[n].td=this.formatFootCell(h[n],t),h[n].content=t.content||null,h[n].foot_cfg=t,t.formatter&&(h[n].formatter=t.formatter),t.className&&(h[n].className=t.className))},this),e.Array.each(h,function(e){e.td=e.td||"",e.content=e.content||null,a+=this.fnReplace(this.TMPL_td,{tdClass:e.className||"",content:e.td}),this.node_cols.push(e)},this),d=this._dt.getClassName("footer"),m=this.TMPL_tfoot,v=this.fnReplace(m,{footClass:d,th_content:u,td_content:a}),t.append(e.Node.create(v)),this.fire("renderFooter"),this},calcDatasetValue:function(t,n){var r=this._dt.get("data"),i=0,s,o,u,a;if(e.Lang.isString(n))return s=n.toLowerCase(),o=s.search(/\{average\}|\{avg\}|\{mean\}/i),s.search(/\{row_count\}/)!==-1?r.size():s.search(/\{col_count\}/)!==-1?this._dt.get("columns").length:s.search(/\{date\}/)!==-1?e.DataType.Date.format(new Date,{format:this.dateFormat}):s.search(/\{time\}/)!==-1?e.DataType.Date.format(new Date,{format:this.timeFormat}):(s.search(/\{min\}|\{max\}/)!==-1&&(i=parseFloat(r.item(0).get(t))),r.each(function(e){u=e.get(t),a=+u,s.search(/\{sum\}/)!==-1||o!==-1?i+=a:s.search(/\{min\}/)!==-1?i=Math.min(i,a):s.search(/\{max\}/)!==-1?i=Math.max(i,a):i=n}),o!==-1&&(i=r.isEmpty()?0:parseFloat(i)/parseFloat(r.size())),parseFloat(i));if(e.Lang.isNumber(n))return n;if(e.Lang.isFunction(n))return n.call(this,r)},formatFootCell:function(t,n){if(!n.content)return"";var r=this.calcDatasetValue(n.key,n.content),i,s,o;return i=n.formatter&&e.Lang.isFunction(n.formatter)?n.formatter:t.formatter&&e.Lang.isFunction(t.formatter)?t.formatter:null,r=i&&i.call?i.call(this,{value:r,column:t}):r,e.Lang.isFunction(n.content)?r:(s=n.content.match(/\{.*\}/)[0]||null,o=n.content,s&&e.Lang.isString(s)&&(o=o.replace(s,r)),o)},refreshFooter:function(){var t=this._dt,n=t._tfootNode,r=n.all("th,td"),i,s;return e.Array.each(this.node_cols,function(n,o){n.th&&(s={ROW_COUNT:t.data.size(),COL_COUNT:t.get("columns").length,DATE:e.DataType.Date.format(new Date,{format:this.get("dateFormat")}),TIME:e.DataType.Date.format(new Date,{format:this.get("timeFormat")})},e.Object.each(s,function(e,t,n){n[t.toLowerCase()]=e}),i=this.fnReplace(n.th.content,s)),!n.th&&n.content&&(i=this.formatFootCell(n,n.foot_cfg)),i&&r.item(o).setHTML(i)},this),this.fire("refreshFooter"),this},resizeFooter:function(){function t(e,t){var n=e.getComputedStyle(t),r=n?+n.replace(/px/,""):0;return r}var n=this._dt,r=n.get("contentBox").one("."+n.getClassName("scroll","columns")),i=this._dt._tfootNode,s=i.all("th,td"),o,u,a,f;return n._yScroll&&(a=r.all("th"),e.Array.each(this.node_cols,function(e,n){o=0;if(e.th){for(f=0;f<e.th.colspan;f++)u=a.item(e.index+f),o+=t(u,"width");o+=e.th.colspan-1}else u=a.item(e.index),o=t(u,"width")-20;s.item(n).setStyle("width",o+"px")})),this.fire("resizeFooter"),this},_buildFixedFooter:function(){var t=this._yScrollFooter,n=this._yScrollContainer,r,i;t||(r='<table cellspacing="0" aria-hidden="true" class="{className}"></table>',t=e.Node.create(e.Lang.sub(this._Y_SCROLL_FOOTER_TEMPLATE||this.foot.TMPL_table_fixed||r,{className:this.getClassName("footer")})),this._yScrollFooter=t,n.append(t),i=this.get("contentBox").one("table > tfoot"),this._tfootNode=i,i&&(this._yScrollFooter.append(i),this.foot.resizeFooter()))}})},"@VERSION@",{skinnable:"true",requires:["base-build","datatable-base","view"]});
